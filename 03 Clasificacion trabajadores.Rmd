---
title: "Clasificacion trabajadores"
author: "Leonardo Daniel Rosas Rios"
date: "2025-08-26"
output: html_document
---


# Lectura de datos
```{r, echo=TRUE, message=FALSE, warning=FALSE}
#Bibliotecas
library(readxl)
library(dplyr)
library(ISOweek)
library(reshape2)
library(ggplot2)
library(writexl)
library(sandwich)   
library(lmtest)     
library(GGally)
library(tseries)



#Funciones
source("R/utils.R")

#semilla
set.seed(123)


```




# Lectura de datos
```{r}
#Lectura de base de datos
Evalim <- read_excel("Data/Base_inidicadores.xlsx")
Evalim
```








# Clasificacion de asesores en niveles de productividad


## Clasificacion cuadrantes
```{r}

Evalim <- Evalim %>%
  mutate(
    Nivel_Prod = case_when(
      `Cumplimiento colocacion` > 1 & `Cumplimiento Cartera` > 1 ~ 1,
      `Cumplimiento colocacion` <= 1 & `Cumplimiento Cartera` > 1 ~ 2,
      `Cumplimiento colocacion` > 1 & `Cumplimiento Cartera` <= 1 ~ 3,
      TRUE ~ 4
    )
  )



ggplot(Evalim, aes(x = `Cumplimiento colocacion`,
                   y = `Cumplimiento Cartera`,
                   color = factor(Nivel_Prod))) +
  geom_point(alpha = 0.4, size = 1) +
  geom_vline(xintercept = 1, linetype = "dashed") +
  geom_hline(yintercept = 1, linetype = "dashed") +
  labs(color = "Nivel productividad",
       x = "Cumplimiento Colocación",
       y = "Cumplimiento Cartera") +
  theme_minimal() +
  scale_color_manual(values = c(
    "1" = "#F8766D",  # rojo
    "2" = "#7CAE00",  # verde
    "3" = "#00BFC4",  # turquesa
    "4" = "#C77CFF"   # morado
  ))

```


```{r}
table(Evalim$Nivel_Prod)
prop.table(table(Evalim$Nivel_Prod))

```


```{r}
colSums(is.na(Evalim))

```






## Clasificacion k-means

```{r,warning=FALSE, message=FALSE}

# Matriz de features
features <- Evalim %>%
  select(`Cumplimiento colocacion`, `Cumplimiento Cartera`) %>%
  na.omit()

# Escalamos
features_scaled <- scale(features)

# k-means (4 clusters)
km <- kmeans(features_scaled, centers = 4, nstart = 25)

# Añadimos clusters al df
Evalim$Cluster <- NA
Evalim$Cluster[as.numeric(rownames(features))] <- km$cluster


ggplot(Evalim, aes(x = `Cumplimiento colocacion`,
                   y = `Cumplimiento Cartera`,
                   color = factor(Cluster))) +
  geom_point(alpha = 0.4, size = 1) +
  labs(color = "Cluster k-means",
       x = "Cumplimiento Colocación",
       y = "Cumplimiento Cartera") +
  theme_minimal()

```


